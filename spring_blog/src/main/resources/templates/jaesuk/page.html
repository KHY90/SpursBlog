<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Quokka Blog</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>

        @font-face {
            font-family: 'MangoDdobak-B';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2405-3@1.1/MangoDdobak-B.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'ONE-Mobile-POP', sans-serif;

        }

        body {
            background-image: linear-gradient(to top, #9795f0 0%, #fbc8d4 100%);
            display: flex;
            flex-direction: column;
        }

        .hero {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 5rem 0;
            color: white;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 2rem;
            margin-top: 2rem;
        }

        #postList .card {
            margin-bottom: 1rem;
        }

        .post-view {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #fff;
            border-radius: 10px;
            display: none;
        }

        @font-face {
            font-family: 'ONE-Mobile-POP';
            src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/noonfonts_2105_2@1.0/ONE-Mobile-POP.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        /* 여기에 기존의 스타일 코드를 넣으세요 */

    </style>
</head>

<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
        <a class="navbar-brand" href="#">Happy Quokka blog</a>
    </nav>

    <div class="row">
        <div class="col-md-6">
            <div class="calendar" id="calendar"></div>
        </div>
        <div class="col-md-6 d-flex justify-content-center align-items-center">
            <img src="https://i.pinimg.com/736x/98/83/9b/98839b7732cb73afd4065220239967eb.jpg" alt="Summer Image" class="summer-image">
        </div>
    </div>

    <div id="mainView">
        <div class="mb-3 d-flex justify-content-between">
            <button id="newPostBtn" class="btn btn-primary">새 글 작성</button>
            <div class="form-inline">
                <input type="text" id="searchInput" class="form-control mr-2" placeholder="검색어 입력">
                <button id="searchBtn" class="btn btn-outline-secondary">검색</button>
            </div>
        </div>
        <table class="table table-striped">
            <thead>
            <tr>
                <th>No</th>
                <th>제목</th>
                <th>글쓴이</th>
                <th>작성시간</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="postList"></tbody>
        </table>
    </div>

<body>
<div class="hero" id="mainHero">
    <h1 class="display-4">Welcome Happy Quokka Blog</h1>
    <button id="showPostListBtn" class="btn btn-light mt-3">게시판 보기</button>
</div>
<div id="mainContainer" class="container" style="display:none;">
    <h1 id="pageTitle">게시판</h1>
    <div id="postList"></div>
    <div id="postForm" style="display:none;">
        <h2 id="formTitle">새 게시글 작성</h2>
        <form id="postFormElement">
            <input type="hidden" id="postId">
            <div class="form-group">
                <label for="title">제목</label>
                <input type="text" class="form-control" id="title" required>
            </div>
            <div class="form-group">
                <label for="content">내용</label>
                <textarea class="form-control" id="content" rows="5" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">저장</button>
            <button type="button" class="btn btn-secondary" id="cancelBtn">취소</button>
        </form>
    </div>
    <button id="newPostBtn" class="btn btn-primary mt-3">새 글 작성</button>
    <button id="homeBtn" class="btn btn-secondary mt-3 ml-2">홈으로</button>

    <!-- 게시글 보기 섹션 -->
    <div id="postView" class="post-view">
        <h2 id="viewTitle"></h2>
        <p id="viewContent"></p>
        <p><small class="text-muted" id="viewCreatedAt"></small></p>
        <p><small class="text-muted" id="viewViews"></small></p>
        <button class="btn btn-secondary" id="backToListBtn">목록으로</button>

        <hr>
        <h3>댓글</h3>
        <div id="commentList"></div>
        <form id="commentForm" class="mt-3">
            <div class="form-group">
                <label for="commentContent">댓글 내용</label>
                <textarea class="form-control" id="commentContent" rows="3" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">댓글 작성</button>
        </form>
    </div>

    <div id="mainView">
        <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${message}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${error}"></span>
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <div class="mb-3 d-flex justify-content-between">
            <a th:href="@{/jaesuk/post}" class="btn btn-primary">새 글 작성</a>
            <div class="form-inline">
                <input type="text" id="searchInput" class="form-control mr-2" placeholder="검색어 입력">
                <button type="button" id="searchBtn" class="btn btn-outline-secondary">검색</button>
            </div>
        </div>

        <table class="table table-striped" th:if="${posts != null and not #lists.isEmpty(posts)}">
            <thead>
            <tr>
                <th>No</th>
                <th>제목</th>
                <th>작성시간</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="post, iterStat : ${posts}">
                <td th:text="${posts.size() - iterStat.index}"></td>
                <td>
                    <a th:href="@{/jaesuk/post/{id}(id=${post.blogNo})}"
                       th:text="${post.blogTitle ?: '(제목 없음)'}">
                    </a>
                </td>
                <td th:text="${post.formattedDate ?: '날짜 없음'}"></td>
                <td>
                    <a th:href="@{/jaesuk/edit/{id}(id=${post.blogNo})}" class="btn btn-sm btn-info">수정</a>
                    <a th:href="@{/jaesuk/delete/{id}(id=${post.blogNo})}" class="btn btn-sm btn-danger">삭제</a>
                </td>
            </tr>
            </tbody>
        </table>
        <div th:if="${posts == null or #lists.isEmpty(posts)}" class="alert alert-info">
            게시글이 없습니다.
        </div>

        <!-- 댓글 목록 -->
        <div id="commentList" class="mt-4"></div>

        <!-- 댓글 입력 폼 -->
        <div class="mt-4">
            <h5>댓글 작성</h5>
            <form id="commentForm">
                <div class="form-group">
                    <label for="commentContent">내용</label>
                    <textarea class="form-control" id="commentContent" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">댓글 달기</button>
            </form>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    let posts = JSON.parse(localStorage.getItem('posts')) || [];
    let currentPostId = null;

    function savePosts() {
        localStorage.setItem('posts', JSON.stringify(posts));
    }

    function displayPosts() {
        const postList = document.getElementById('postList');
        postList.innerHTML = '';
        posts.forEach(post => {
            const postElement = document.createElement('div');
            postElement.className = 'card';
            postElement.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${post.title}</h5>
                    <p class="card-text">
                        <small class="text-muted">${new Date(post.createdAt).toLocaleString()}</small>
                        <span class="ml-2">조회수: ${post.views}</span>
                    </p>
                    <button class="btn btn-info view-btn" data-id="${post.id}">보기</button>
                    <button class="btn btn-warning edit-btn" data-id="${post.id}">수정</button>
                    <button class="btn btn-danger delete-btn" data-id="${post.id}">삭제</button>
                </div>
            `;
            postList.appendChild(postElement);
        });
    }

    function displayComments(postId) {
        const post = posts.find(p => p.id === postId);
        const commentList = document.getElementById('commentList');
        commentList.innerHTML = '';

        if (post && post.comments) {
            post.comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'card mt-2';
                commentElement.innerHTML = `
                    <div class="card-body">
                        <p class="card-text">${comment.content}</p>
                        <p class="card-text"><small class="text-muted">${new Date(comment.createdAt).toLocaleString()}</small></p>
                    </div>
                `;
                commentList.appendChild(commentElement);
            });
        }
    }

    function showPostForm(post = null) {
        document.getElementById('postList').style.display = 'none';
        document.getElementById('newPostBtn').style.display = 'none';
        document.getElementById('homeBtn').style.display = 'none';
        document.getElementById('postForm').style.display = 'block';
        document.getElementById('postView').style.display = 'none';

        if (post) {
            document.getElementById('formTitle').textContent = '게시글 수정';
            document.getElementById('postId').value = post.id;
            document.getElementById('title').value = post.title;
            document.getElementById('content').value = post.content;
        } else {
            document.getElementById('formTitle').textContent = '새 게시글 작성';
            document.getElementById('postId').value = '';
            document.getElementById('title').value = '';
            document.getElementById('content').value = '';
        }
    }

    function hidePostForm() {
        document.getElementById('postList').style.display = 'block';
        document.getElementById('newPostBtn').style.display = 'inline-block';
        document.getElementById('homeBtn').style.display = 'inline-block';
        document.getElementById('postForm').style.display = 'none';
        document.getElementById('postView').style.display = 'none';
    }

    function showPostView(post) {
        document.getElementById('postList').style.display = 'none';
        document.getElementById('newPostBtn').style.display = 'none';
        document.getElementById('homeBtn').style.display = 'none';
        document.getElementById('postForm').style.display = 'none';

        document.getElementById('viewTitle').textContent = post.title;
        document.getElementById('viewContent').textContent = post.content;
        document.getElementById('viewCreatedAt').textContent = `작성일: ${new Date(post.createdAt).toLocaleString()}`;
        document.getElementById('viewViews').textContent = `조회수: ${post.views}`;

        displayComments(post.id);

        document.getElementById('postView').style.display = 'block';
        currentPostId = post.id;
    }

    document.getElementById('showPostListBtn').addEventListener('click', () => {
        document.getElementById('mainHero').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';
        displayPosts();
    });

    document.getElementById('newPostBtn').addEventListener('click', () => showPostForm());

    document.getElementById('cancelBtn').addEventListener('click', hidePostForm);

    document.getElementById('homeBtn').addEventListener('click', () => {
        document.getElementById('mainHero').style.display = 'flex';
        document.getElementById('mainContainer').style.display = 'none';
    });

    document.getElementById('backToListBtn').addEventListener('click', () => {
        hidePostForm();
    });

    document.getElementById('postFormElement').addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('postId').value;
        const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;

        if (id) {
            const postIndex = posts.findIndex(post => post.id === parseInt(id));
            if (postIndex !== -1) {
                posts[postIndex].title = title;
                posts[postIndex].content = content;
            }
        } else {
            const newPost = {
                id: Date.now(),
                title,
                content,
                createdAt: new Date().toISOString(),
                views: 0,
                comments: []
            };
            posts.unshift(newPost);
        }

        savePosts();
        hidePostForm();
        displayPosts();
    });

    document.getElementById('commentForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const content = document.getElementById('commentContent').value;

        const newComment = {
            content,
            createdAt: new Date().toISOString()
        };

        const postIndex = posts.findIndex(post => post.id === currentPostId);
        if (postIndex !== -1) {
            posts[postIndex].comments.push(newComment);
            savePosts();
            displayComments(currentPostId);
            document.getElementById('commentContent').value = '';
        }
    });

    document.getElementById('postList').addEventListener('click', (e) => {
        const postId = parseInt(e.target.dataset.id);
        if (e.target.classList.contains('view-btn')) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                post.views++;
                savePosts();
                showPostView(post);
            }
        } else if (e.target.classList.contains('edit-btn')) {
            const post = posts.find(p => p.id === postId);
            if (post) {
                showPostForm(post);
            }
        } else if (e.target.classList.contains('delete-btn')) {
            if (confirm('정말 삭제하시겠습니까?')) {
                posts = posts.filter(p => p.id !== postId);
                savePosts();
                displayPosts();
            }
        }
    });

    // 초기 게시글 로드
    displayPosts();

<script th:inline="javascript">
    let currentYear, currentMonth;
    let posts = /*[[${posts}]]*/ [];

    function createCalendar(year, month) {
        // 기존의 createCalendar 함수 내용
    }

    function changeMonth(delta) {
        // 기존의 changeMonth 함수 내용
    }

    function showPostsOnDate(date) {
        // 기존의 showPostsOnDate 함수 내용
    }

    function searchPosts() {
        const searchTerm = $('#searchInput').val().toLowerCase();
        const filteredPosts = posts.filter(post =>
            post.blogTitle.toLowerCase().includes(searchTerm) ||
            post.blogContent.toLowerCase().includes(searchTerm)
        );
        displayPosts(filteredPosts);
    }

    function displayPosts(postsToDisplay = posts) {
        // 여기서는 Thymeleaf가 서버 측에서 렌더링하므로 클라이언트 측 렌더링 로직은 제거
    }

    $('#searchBtn').click(searchPosts);

    $('#searchInput').on('keyup', function (e) {
        if (e.key === 'Enter') {
            searchPosts();
        }
    });

    // 초기화
    const today = new Date();
    createCalendar(today.getFullYear(), today.getMonth() + 1);
</script>
</body>
</html>
